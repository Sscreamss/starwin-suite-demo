<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuraci√≥n - Starwin Suite</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #3b82f6;
      --success: #10b981;
      --danger: #ef4444;
      --dark: #0f172a;
      --gray: #64748b;
      --gray-light: #e2e8f0;
      --white: #ffffff;

      --card: rgba(30, 41, 59, 0.60);
      --card-border: rgba(100, 116, 139, 0.30);
      --input-bg: rgba(15, 23, 42, 0.80);
      --input-border: rgba(100, 116, 139, 0.50);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      min-height: 100vh;
      padding: 18px;
    }

    .layout {
      max-width: 1280px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 18px;
      align-items: start;
    }

    .sidebar {
      position: sticky;
      top: 18px;
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 16px;
      backdrop-filter: blur(8px);
    }

    .brand { display: flex; gap: 10px; align-items: center; margin-bottom: 14px; }
    .brand .icon { width: 38px; height: 38px; border-radius: 10px; display: grid; place-items: center; background: rgba(59,130,246,.18); border: 1px solid rgba(59,130,246,.30); color: var(--primary); }
    .brand h1 { font-size: 16px; line-height: 1.2; color: #fff; margin: 0; }
    .brand p { font-size: 12px; color: var(--gray); margin-top: 2px; }

    .search { margin: 14px 0 10px; position: relative; }
    .search i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--gray); font-size: 14px; pointer-events: none; }
    .search input { width: 100%; padding: 10px 12px 10px 34px; border-radius: 10px; border: 1px solid var(--input-border); background: var(--input-bg); color: #fff; font-size: 13px; outline: none; }
    .search input:focus { border-color: rgba(59,130,246,.6); }

    .nav { display: flex; flex-direction: column; gap: 4px; margin-bottom: 14px; }
    .nav button { display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: transparent; border: 1px solid transparent; border-radius: 10px; color: #94a3b8; cursor: pointer; font-size: 13px; font-weight: 600; text-align: left; transition: all .18s ease; }
    .nav button:hover { background: rgba(59,130,246,.08); color: #e2e8f0; }
    .nav button.active { background: rgba(59,130,246,.15); border-color: rgba(59,130,246,.35); color: #60a5fa; }
    .nav button i { width: 20px; text-align: center; }

    .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
    .btn-save, .btn-cancel { padding: 10px; border-radius: 10px; border: none; cursor: pointer; font-size: 13px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 6px; transition: all .18s ease; }
    .btn-save { background: var(--primary); color: #fff; }
    .btn-save:hover { background: #2563eb; transform: translateY(-1px); }
    .btn-cancel { background: rgba(100,116,139,.15); color: #94a3b8; border: 1px solid rgba(100,116,139,.30); }
    .btn-cancel:hover { background: rgba(100,116,139,.25); color: #e2e8f0; }

    .main { min-width: 0; }

    .alert { padding: 14px; border-radius: 10px; margin-bottom: 10px; display: none; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; }
    .alert.show { display: flex; }
    .alert-success { background: rgba(16,185,129,.12); border: 1px solid rgba(16,185,129,.30); color: #34d399; }
    .alert-error { background: rgba(239,68,68,.12); border: 1px solid rgba(239,68,68,.30); color: #f87171; }

    .panel { background: var(--card); border: 1px solid var(--card-border); border-radius: 12px; padding: 18px; backdrop-filter: blur(8px); }
    .panel-header { display: flex; align-items: center; gap: 10px; margin-bottom: 14px; padding-bottom: 12px; border-bottom: 1px solid rgba(100,116,139,.25); }
    .panel-header i { color: var(--primary); font-size: 18px; }
    .panel-header h2 { font-size: 16px; color: #fff; margin: 0; }
    .panel-header p { margin-left: auto; color: var(--gray); font-size: 12px; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }

    .form-group { margin-bottom: 14px; }
    .form-group label { display: block; color: #e2e8f0; font-weight: 700; margin-bottom: 8px; font-size: 13px; }
    .hint { display: block; margin-top: 4px; color: var(--gray); font-weight: 400; font-size: 12px; }

    input, textarea { width: 100%; padding: 11px 12px; background: var(--input-bg); border: 1px solid var(--input-border); border-radius: 10px; color: #ffffff; font-size: 13px; font-family: inherit; outline: none; }
    textarea { min-height: 110px; resize: vertical; line-height: 1.45; }
    input:focus, textarea:focus { border-color: rgba(59,130,246,.8); background: rgba(15,23,42,.9); }

    .char-count { text-align: right; color: var(--gray); font-size: 12px; margin-top: 6px; }

    .preview { background: rgba(15,23,42,.55); padding: 14px; border-radius: 10px; white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 12px; border: 1px solid rgba(100,116,139,.25); }
    .info-box { background: rgba(59,130,246,.08); border: 1px solid rgba(59,130,246,.25); border-radius: 10px; padding: 14px; margin-bottom: 14px; font-size: 13px; color: #94a3b8; line-height: 1.5; }
    .info-box i { color: var(--primary); margin-right: 6px; }

    .tab { display: none; }
    .tab.active { display: block; }

    .tag { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px; font-size: 12px; border: 1px solid rgba(100,116,139,.25); background: rgba(15,23,42,.35); color: #cbd5e1; }
    .tag i { color: var(--primary); }

    /* ‚úÖ NUEVO: Deposit Image Selector */
    .deposit-image-selector {
      display: flex;
      gap: 14px;
      align-items: flex-start;
    }
    .image-preview {
      width: 160px;
      height: 120px;
      border-radius: 10px;
      border: 2px dashed rgba(100, 116, 139, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: rgba(15, 23, 42, 0.5);
      flex-shrink: 0;
    }
    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }
    .image-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: rgba(100, 116, 139, 0.6);
      font-size: 12px;
    }
    .image-placeholder i {
      font-size: 28px;
    }
    .image-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .btn-image-select {
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.4);
      color: #60a5fa;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
    }
    .btn-image-select:hover {
      background: rgba(59, 130, 246, 0.35);
      transform: translateY(-1px);
    }
    .btn-image-remove {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
    }
    .btn-image-remove:hover {
      background: rgba(239, 68, 68, 0.3);
    }

    /* Inline number input */
    .inline-number { display: flex; align-items: center; gap: 10px; }
    .inline-number input[type="number"] { width: 80px; text-align: center; }
    .inline-number span { color: var(--gray); font-size: 12px; }

    @media (max-width: 980px) {
      .layout { grid-template-columns: 1fr; }
      .sidebar { position: relative; top: 0; }
      .grid-2 { grid-template-columns: 1fr; }
      .grid-3 { grid-template-columns: 1fr; }
      .sidebar .actions { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="layout">

    <aside class="sidebar">
      <div class="brand">
        <div class="icon"><i class="fas fa-cog"></i></div>
        <div>
          <h1>Configuraci√≥n</h1>
          <p>Mensajes y par√°metros</p>
        </div>
      </div>

      <div class="search">
        <i class="fas fa-search"></i>
        <input id="searchInput" type="text" placeholder="Buscar (ej: cbu, usuario, soporte)..." />
      </div>

      <div class="nav">
        <button class="active" data-tab="tab-usuarios"><i class="fas fa-user-cog"></i> Creaci√≥n de usuarios</button>
        <button data-tab="tab-deposito"><i class="fas fa-money-bill-wave"></i> Flujo de dep√≥sito</button>
        <button data-tab="tab-avanzado"><i class="fas fa-sliders"></i> Avanzado</button>
      </div>

      <div class="actions">
        <button class="btn-save" id="btnSave"><i class="fas fa-save"></i> Guardar</button>
        <button class="btn-cancel" id="btnCancel"><i class="fas fa-times"></i> Volver</button>
      </div>

      <div style="margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap;">
        <span class="tag"><i class="fas fa-shield"></i> Sin tocar comandos</span>
        <span class="tag"><i class="fas fa-pen"></i> Solo texto</span>
      </div>
    </aside>

    <main class="main">
      <div id="alertContainer"></div>

      <!-- TAB: Creaci√≥n de Usuarios -->
      <section class="tab active" id="tab-usuarios">
        <div class="panel">
          <div class="panel-header">
            <i class="fas fa-user-cog"></i>
            <h2>Creaci√≥n de Usuarios</h2>
            <p>Flujo autom√°tico de registro</p>
          </div>

          <div class="info-box">
            <i class="fas fa-info-circle"></i>
            <strong>Flujo simplificado:</strong> Cuando alguien escribe por primera vez, el bot le pide el nombre directamente y arranca la creaci√≥n de usuario autom√°ticamente.
          </div>

          <div class="form-group">
            <label>
              Primer mensaje del bot (pedir nombre)
              <span class="hint">Este es el primer mensaje que recibe cualquier persona. Debe pedir el nombre.</span>
            </label>
            <textarea id="askNameMessage" maxlength="500" data-search="nombre primer mensaje bienvenida askname"></textarea>
            <div class="char-count" id="askNameCount">0 / 500</div>
          </div>

          <div class="form-group">
            <label>
              Mensaje de nombre inv√°lido
              <span class="hint">Cuando el nombre no cumple el formato</span>
            </label>
            <textarea id="invalidNameMessage" maxlength="500" data-search="nombre invalido error"></textarea>
            <div class="char-count" id="invalidNameCount">0 / 500</div>
          </div>

          <div class="grid-2">
            <div class="form-group">
              <label>
                Mensaje "creando usuario..."
                <span class="hint">Se env√≠a mientras se crea la cuenta</span>
              </label>
              <input id="creatingMessage" maxlength="200" data-search="creando espera usuario" />
              <div class="char-count" id="creatingCount">0 / 200</div>
            </div>

            <div class="form-group">
              <label>
                Mensaje "esper√° un momento"
                <span class="hint">Si el usuario manda algo mientras se crea la cuenta</span>
              </label>
              <input id="creatingUserWaitMessage" maxlength="300" data-search="espera momento creando usuario wait" />
              <div class="char-count" id="creatingUserWaitCount">0 / 300</div>
            </div>
          </div>

          <div class="grid-2">
            <div class="form-group">
              <label>
                Contrase√±a fija
                <span class="hint">Todos los usuarios tendr√°n esta contrase√±a</span>
              </label>
              <input type="text" id="fixedPassword" placeholder="Ej: Hola1234" maxlength="50" data-search="password contrase√±a" />
              <div class="char-count" id="fixedPasswordCount">0 / 50</div>
            </div>

            <div class="form-group">
              <label>
                Sufijo de usuario
                <span class="hint">Se agrega al final del username</span>
              </label>
              <input type="text" id="usernameSuffix" placeholder="Ej: _starwin" maxlength="20" data-search="suffix sufijo username" />
              <div class="char-count" id="usernameSuffixCount">0 / 20</div>
            </div>
          </div>

          <div class="form-group">
            <label>
              URL del sitio
              <span class="hint">Se muestra en el mensaje de cuenta creada</span>
            </label>
            <input type="url" id="siteUrl" placeholder="https://admin.starwin.plus" data-search="url sitio" />
            <div class="char-count" id="siteUrlCount">0 / 300</div>
          </div>

          <!-- ‚úÖ Etiquetas de cuenta creada -->
          <div class="panel-header" style="margin-top: 10px;">
            <i class="fas fa-paper-plane"></i>
            <h2>Mensajes de cuenta creada</h2>
            <p>Etiqueta + dato = 2 mensajes c/u</p>
          </div>

          <div class="info-box">
            <i class="fas fa-copy"></i>
            Cada dato se env√≠a en <strong>2 mensajes separados</strong>: primero la etiqueta (ej: "üë§ Tu usuario es:") y despu√©s el dato solo (ej: "martin4479_starwin").
            As√≠ el usuario puede copiar el dato limpio.
          </div>

          <div class="grid-3">
            <div class="form-group">
              <label>
                Etiqueta: Usuario
                <span class="hint">Despu√©s se manda el username solo</span>
              </label>
              <input id="createdUserLabel" maxlength="200" data-search="cuenta creada username usuario etiqueta label" />
              <div class="char-count" id="createdUserLabelCount">0 / 200</div>
            </div>

            <div class="form-group">
              <label>
                Etiqueta: Contrase√±a
                <span class="hint">Despu√©s se manda la password sola</span>
              </label>
              <input id="createdPassLabel" maxlength="200" data-search="cuenta creada password contrase√±a etiqueta label" />
              <div class="char-count" id="createdPassLabelCount">0 / 200</div>
            </div>

            <div class="form-group">
              <label>
                Etiqueta: Link
                <span class="hint">Despu√©s se manda la URL sola</span>
              </label>
              <input id="createdUrlLabel" maxlength="200" data-search="cuenta creada url link sitio etiqueta label" />
              <div class="char-count" id="createdUrlLabelCount">0 / 200</div>
            </div>
          </div>

          <div class="form-group">
            <label style="color: #cbd5e1; font-weight: 600; font-size: 12px;">
              <i class="fas fa-eye"></i> Vista previa (datos de ejemplo)
            </label>
            <div id="previewMessages" class="preview"></div>
          </div>

          <div class="form-group">
            <label>
              Pregunta de dep√≥sito
              <span class="hint">Se env√≠a despu√©s de crear la cuenta. El usuario responde SI o NO.</span>
            </label>
            <textarea id="askDepositMessage" maxlength="500" data-search="deposito preguntar si no"></textarea>
            <div class="char-count" id="askDepositCount">0 / 500</div>
          </div>

          <!-- ‚úÖ NUEVO: Mensaje bienvenida de vuelta -->
          <div class="panel-header" style="margin-top: 10px;">
            <i class="fas fa-hand-peace"></i>
            <h2>Mensaje de bienvenida (usuarios con cuenta)</h2>
            <p>Cuando ya complet√≥ el flujo</p>
          </div>

          <div class="form-group">
            <label>
              Mensaje de bienvenida de vuelta
              <span class="hint">Se env√≠a cuando un usuario que ya tiene cuenta escribe un mensaje no reconocido. Tip: incluir los comandos disponibles (DEPOSITO, SOPORTE, INFO).</span>
            </label>
            <textarea id="welcomeBackMessage" maxlength="800" data-search="bienvenida vuelta completado welcome back"></textarea>
            <div class="char-count" id="welcomeBackCount">0 / 800</div>
          </div>
        </div>
      </section>

      <!-- TAB: Dep√≥sito -->
      <section class="tab" id="tab-deposito">
        <div class="panel">
          <div class="panel-header">
            <i class="fas fa-money-bill-wave"></i>
            <h2>Flujo de Dep√≥sito</h2>
            <p>Mensajes de pago y comprobante</p>
          </div>

          <div class="grid-2">
            <div class="form-group">
              <label>
                Mensaje datos bancarios (parte 1)
                <span class="hint">Se env√≠a antes del CBU. Pod√©s usar emojis y saltos de l√≠nea.</span>
              </label>
              <textarea id="bankDetailsMessage" maxlength="1200" data-search="banco datos bancarios titular alias"></textarea>
              <div class="char-count" id="bankDetailsCount">0 / 1200</div>
            </div>

            <div class="form-group">
              <label>
                CBU (parte 2)
                <span class="hint">Se env√≠a como mensaje separado</span>
              </label>
              <input id="cbuMessage" maxlength="60" data-search="cbu" />
              <div class="char-count" id="cbuCount">0 / 60</div>
            </div>
          </div>

          <!-- ‚úÖ NUEVO: Imagen de dep√≥sito -->
          <div class="form-group">
            <label>
              Imagen de dep√≥sito
              <span class="hint">Se env√≠a despu√©s de los datos bancarios y CBU. Formatos: JPG, PNG, GIF, WebP</span>
            </label>
            <div class="deposit-image-selector">
              <div id="depositImagePreview" class="image-preview">
                <div class="image-placeholder">
                  <i class="fas fa-image"></i>
                  <span>Sin imagen configurada</span>
                </div>
              </div>
              <div class="image-actions">
                <button type="button" id="btnSelectDepositImage" class="btn-image-select">
                  <i class="fas fa-upload"></i> Seleccionar imagen
                </button>
                <button type="button" id="btnRemoveDepositImage" class="btn-image-remove" style="display:none;">
                  <i class="fas fa-trash"></i> Quitar imagen
                </button>
              </div>
            </div>
          </div>

          <div class="grid-2">
            <div class="form-group">
              <label>
                Mensaje "envi√° el comprobante"
                <span class="hint">Despu√©s de mostrar datos+CBU, el bot pide la foto</span>
              </label>
              <textarea id="askProofMessage" maxlength="800" data-search="comprobante foto enviar"></textarea>
              <div class="char-count" id="askProofCount">0 / 800</div>
            </div>

            <div class="form-group">
              <label>
                Mensaje cuando NO deposita
                <span class="hint">Incluye "Para mandar tu primera carga escrib√≠: Deposito"</span>
              </label>
              <textarea id="depositNoMessage" maxlength="800" data-search="no deposito despues"></textarea>
              <div class="char-count" id="depositNoCount">0 / 800</div>
            </div>
          </div>

          <div class="form-group">
            <label>
              Mensaje al recibir foto (derivaci√≥n a caja)
              <span class="hint">Se env√≠a cuando el usuario manda una imagen en WAIT_PROOF</span>
            </label>
            <textarea id="proofRedirectMessage" maxlength="2000" data-search="derivo caja linea principal whatsapp comprobante"></textarea>
            <div class="char-count" id="proofRedirectCount">0 / 2000</div>
          </div>

          <!-- ‚úÖ NUEVO: Recordatorio de comprobante -->
          <div class="panel-header" style="margin-top: 10px;">
            <i class="fas fa-bell"></i>
            <h2>Recordatorio de comprobante</h2>
            <p>Se env√≠a si no mandan la foto a tiempo</p>
          </div>

          <div class="info-box">
            <i class="fas fa-clock"></i>
            Si el usuario dice que va a depositar pero no env√≠a el comprobante, el bot le manda un recordatorio autom√°tico. Poner 0 para desactivar.
          </div>

          <div class="form-group">
            <label>
              Mensaje de recordatorio
              <span class="hint">Se env√≠a tras X minutos sin recibir el comprobante</span>
            </label>
            <textarea id="proofReminderMessage" maxlength="800" data-search="recordatorio reminder comprobante timeout"></textarea>
            <div class="char-count" id="proofReminderCount">0 / 800</div>
          </div>

          <div class="form-group">
            <label>
              Tiempo de espera (minutos)
              <span class="hint">Minutos antes de enviar el recordatorio. 0 = desactivado.</span>
            </label>
            <div class="inline-number">
              <input type="number" id="proofReminderMinutes" min="0" max="120" value="15" data-search="recordatorio minutos tiempo espera" />
              <span>minutos</span>
            </div>
          </div>
        </div>
      </section>

      <!-- TAB: Avanzado -->
      <section class="tab" id="tab-avanzado">
        <div class="panel">
          <div class="panel-header">
            <i class="fas fa-sliders"></i>
            <h2>Avanzado</h2>
            <p>Opcional</p>
          </div>

          <div class="form-group">
            <label>
              Mensaje de Informaci√≥n
              <span class="hint">Cuando el usuario escribe INFO / INFORMACION</span>
            </label>
            <textarea id="infoMessage" maxlength="1500" data-search="info informacion"></textarea>
            <div class="char-count" id="infoCount">0 / 1500</div>
          </div>

          <div class="form-group">
            <label>
              Mensaje de Soporte
              <span class="hint">Cuando el usuario escribe SOPORTE / AYUDA</span>
            </label>
            <textarea id="supportMessage" maxlength="1500" data-search="soporte ayuda asistencia"></textarea>
            <div class="char-count" id="supportCount">0 / 1500</div>
          </div>

          <div class="form-group">
            <label>
              Nota
              <span class="hint">Info del flujo actual</span>
            </label>
            <div class="preview">
              ‚úî Flujo: mensaje ‚Üí pedir nombre ‚Üí crear usuario ‚Üí etiqueta + dato (√ó3) ‚Üí preguntar dep√≥sito.<br/>
              ‚úî Cada dato (usuario, contrase√±a, link) se env√≠a como mensaje separado para copiar/pegar.<br/>
              ‚úî Los comandos/intents siguen en el engine.<br/>
              ‚úî Recordatorio de comprobante configurable (minutos).<br/>
              ‚úî Mensaje de bienvenida para usuarios que ya completaron el flujo.<br/>
              ‚úî Guard de CREATING_USER: no procesa mensajes mientras se crea la cuenta.
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <script src="config.js"></script>
</body>
</html>